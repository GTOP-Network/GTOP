# Short-read RNA-seq transcript-level quantification and construction of transcript usage phenotypes

Transcript-level quantification of short-read RNA-seq data was performed using **Salmon (v1.10.0)** with the enhanced transcript reference combining GTOP novel transcripts and GENCODE v47 annotations.  
To ensure robustness, technical replication was performed using **RSEM (v1.3.3)** with alignments generated by **STAR (v2.7.3a)**.  
For comparison, Salmon quantification was also performed using the GENCODE v47 reference alone to evaluate the impact of the enhanced transcriptome.

---

```bash
cd scripts
```

## 1. Transcript quantification using Salmon (v1.10.0)

### 1.1 Building transcriptome indices

Salmon indices were constructed from the reference transcriptomes using the `index` module with a k-mer size of 31 (`-k 31`), which defines the k-mer length used for quasi-mapping.

```bash
python salmon_run.py prepare
```

### 1.2 Quasi-mapping quantification

Quantification was performed in quasi-mapping mode using paired-end FASTQ reads.  
The library type `-l ISR` indicates an inward-facing, strand-specific library with read 1 originating from the reverse strand.

The following bias correction options were applied:

- `--validateMappings` to improve mapping accuracy by validating quasi-mappings  
- `--seqBias` to correct sequence-specific biases  
- `--gcBias` to correct GC content-related biases  
- `--posBias` to correct positional biases along transcripts  

To improve computational efficiency, quantification was performed independently for each sample, enabling parallelization.

```bash
python salmon_run.py run
```

### 1.3 Aggregating quantification results

Transcript-level counts were merged across samples, producing a matrix of transcript counts and transcripts per million (TPM) values for downstream analyses.

```bash
python salmon_run.py combine
```

---

## 2. Construction of transcript usage phenotypes for quantitative trait locus (QTL) analysis

Transcript usage was calculated as the proportion of each transcript's expression relative to the total expression of its parent gene.

For each tissue, the following steps were applied:

1. Remove transcripts with median TPM < 0.1  
2. Exclude transcripts with >25% missing values across samples  
3. Impute remaining missing values using the mean expression of each transcript  
4. Normalize the transcript usage matrix via inverse normal transformation  

The resulting transcript usage phenotypes were used for downstream QTL analyses.

```bash
python make_molecular_phenotypes.py
```

---

## 3. Technical replication using RSEM (v1.3.3)

### 3.1 Preparing reference files

```bash
python rsem_run.py prepare
```

### 3.2 Sample-level quantification

```bash
python rsem_run.py run
```

### 3.3 Merging quantification results

```bash
python rsem_run.py combine
```

---
